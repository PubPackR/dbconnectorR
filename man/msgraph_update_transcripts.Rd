% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/msgraph_transcripts_main.R
\name{msgraph_update_transcripts}
\alias{msgraph_update_transcripts}
\title{Update and Process Transcripts from MS Graph API}
\usage{
msgraph_update_transcripts(
  con,
  msgraph_keys,
  openrouter_keys,
  crm_keys,
  openrouter_model = "openai/gpt-5-chat",
  steps = c("load", "anonymize", "summarize", "deanonymize", "export_to_crm"),
  start_date = NULL,
  end_date = Sys.Date() + 1,
  preserved_names = c("studyflix", "study flix", "studi flix", "studiflix"),
  use_test_account = FALSE,
  resume = FALSE,
  log_level = "INFO",
  log_file = NULL
)
}
\arguments{
\item{con}{Database connection object (pool or DBI connection).
Must have access to required tables (see Details)}

\item{msgraph_keys}{List containing MS Graph API credentials with elements:
\itemize{
\item tenant_id: Azure AD tenant ID
\item client_id: Azure AD client/application ID
\item client_secret: Azure AD client secret
Note: This is NOT keys$msgraph from authentication_process(). You need to
construct this list manually with all three elements.
}}

\item{openrouter_keys}{Character string with OpenRouter API key for AI summaries}

\item{crm_keys}{Character string with CRM API key for protocol export}

\item{openrouter_model}{Character string specifying which AI model to use.
Default: "openai/gpt-5-chat"}

\item{steps}{Character vector of pipeline steps to execute.
Options: c("load", "anonymize", "summarize", "deanonymize", "export_to_crm")
Default: all steps}

\item{start_date}{Optional. Date to start transcript retrieval from.
If NULL, automatically determined from last transcript in database.}

\item{end_date}{Optional. Date to end transcript retrieval.
Default: tomorrow (to include today's transcripts)}

\item{preserved_names}{Character vector of company/brand names to preserve
during anonymization (e.g., c("studyflix", "competitor_name"))}

\item{use_test_account}{Logical. If TRUE, exports to test CRM account.
Default: FALSE}

\item{resume}{Logical. If TRUE, resumes from last successful step.
Default: FALSE}

\item{log_level}{Character string specifying logging verbosity.
Options: "DEBUG", "INFO", "WARNING", "ERROR". Default: "INFO"}

\item{log_file}{Optional. File path for logging output.}
}
\value{
Invisible NULL. Function is called for side effects (database updates).
}
\description{
Complete pipeline for Microsoft Teams transcript processing. This function:
\itemize{
\item Retrieves transcripts from MS Graph API for all internal users
\item Anonymizes transcript content using CoreNLP NER
\item Generates AI summaries via OpenRouter API
\item Deanonymizes summaries for CRM export
\item Exports formatted summaries to CRM system as protocols
}
}
\details{
The pipeline tracks state and can be resumed from any step if interrupted.
Each step only processes records that haven't been processed yet.

Required database tables:
\itemize{
\item raw.msgraph_users, raw.msgraph_contacts, raw.msgraph_calls
\item raw.msgraph_call_participants, raw.msgraph_event_participants
\item raw.crm_users, raw.crm_leads, raw.crm_lead_mail_address
\item raw.crm_company_lead_positions
\item mapping.msgraph_call_event, mapping.crm_lead_msgraph_contact
\item processed.msgraph_call_transcripts
\item processed.msgraph_call_transcript_placeholders
}
}
\examples{
\dontrun{
# Basic usage - run complete pipeline
msgraph_update_transcripts(
  con = con,
  msgraph_keys = list(
    tenant_id = "your-tenant-id",
    client_id = "your-client-id",
    client_secret = keys$msgraph
  ),
  openrouter_keys = keys$openrouter,
  crm_keys = keys$crm
)

# Run specific steps only
msgraph_update_transcripts(
  con = con,
  msgraph_keys = list(
    tenant_id = "your-tenant-id",
    client_id = "your-client-id",
    client_secret = keys$msgraph
  ),
  openrouter_keys = keys$openrouter,
  crm_keys = keys$crm,
  steps = c("summarize", "deanonymize", "export_to_crm")
)

# Resume from last successful step
msgraph_update_transcripts(
  con = con,
  msgraph_keys = list(
    tenant_id = "your-tenant-id",
    client_id = "your-client-id",
    client_secret = keys$msgraph
  ),
  openrouter_keys = keys$openrouter,
  crm_keys = keys$crm,
  resume = TRUE
)
}

}
